<html>
    <head>
        <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script>
AFRAME.registerComponent('speed-and-scale-on-click', {
    init: function () {
        this.currentDur = 4000;
        this.currentScale = 1;
        const update = () => {
            this.currentDur = Math.max(500, this.currentDur * 0.7); // accélère, limite min
            this.currentScale = Math.min(3, this.currentScale + 0.2); // grossit, limite max
            this.el.setAttribute('animation', {
                property: 'rotation',
                to: '0 360 0',
                loop: true,
                dur: this.currentDur,
                easing: 'linear',
                repeat: 'indefinite'
            });
            this.el.setAttribute('scale', `${this.currentScale} ${this.currentScale} ${this.currentScale}`);
        };
        this.el.addEventListener('click', update);
        this.el.addEventListener('touchstart', update);
    }
});

AFRAME.registerComponent('click-change-color', {
    init: function () {
        const changeColor = () => {
            const randomColor = '#' + Math.floor(Math.random()*16777215).toString(16);
            this.el.setAttribute('color', randomColor);
        };
        this.el.addEventListener('click', changeColor);
        this.el.addEventListener('touchstart', changeColor);
    }
});

AFRAME.registerComponent('speed-up-rotation-on-click', {
    init: function () {
        this.initialDur = 4000;
        this.fastDur = 700;
        this.animating = false;
        const speedUp = () => {
            if (this.animating) return;
            this.animating = true;
            this.el.setAttribute('animation__rot', {
                property: 'rotation',
                to: '0 360 0',
                loop: true,
                dur: this.fastDur,
                easing: 'linear',
                repeat: 'indefinite'
            });
            setTimeout(() => {
                this.el.setAttribute('animation__rot', {
                    property: 'rotation',
                    to: '0 360 0',
                    loop: true,
                    dur: this.initialDur,
                    easing: 'linear',
                    repeat: 'indefinite'
                });
                this.animating = false;
            }, 1000);
        };
        this.el.addEventListener('click', speedUp);
        this.el.addEventListener('touchstart', speedUp);
    }
});

AFRAME.registerComponent('speed-and-scale-temporary', {
    init: function () {
        this.initialDur = 3500;
        this.fastDur = 700;
        this.initialScale = 1;
        this.bigScale = 2;
        this.animating = false;
        const animate = () => {
            if (this.animating) return;
            this.animating = true;
            this.el.removeAttribute('animation__rot');
            this.el.removeAttribute('animation__scale');
            this.el.setAttribute('animation__rot', {
                property: 'rotation',
                to: '0 360 0',
                loop: true,
                dur: this.fastDur,
                easing: 'linear',
                repeat: 'indefinite'
            });
            this.el.setAttribute('animation__scale', {
                property: 'scale',
                to: `${this.bigScale} ${this.bigScale} ${this.bigScale}`,
                dur: this.fastDur,
                easing: 'easeOutElastic'
            });
            setTimeout(() => {
                this.el.removeAttribute('animation__rot');
                this.el.removeAttribute('animation__scale');
                // Réinitialise la rotation à zéro
                this.el.setAttribute('rotation', '0 0 0');
                this.el.setAttribute('animation__rot', {
                    property: 'rotation',
                    to: '0 360 0',
                    loop: true,
                    dur: this.initialDur,
                    easing: 'linear',
                    repeat: 'indefinite'
                });
                this.el.setAttribute('animation__scale', {
                    property: 'scale',
                    to: `${this.initialScale} ${this.initialScale} ${this.initialScale}`,
                    dur: 700,
                    easing: 'easeOutElastic'
                });
                this.animating = false;
            }, 1000);
        };
        this.el.addEventListener('click', animate);
        this.el.addEventListener('touchstart', animate);
    }
});
        </script>
    </head>
    <body style="margin : 0px; overflow: hidden;">
        <a-scene embedded arjs>
            <a-marker preset="hiro">
                <a-box rotation="0 0 0"
                    scale="1 1 1"
                    material="opacity: 0.5; transparent: true;" 
                    animation__rot="property: rotation; to: 0 360 0; loop: true; dur: 4000; easing: linear; repeat: indefinite"
                    animation__scale="property: scale; to: 1 1 1; dur: 500; easing: easeOutElastic"
                    color="#4CC3D9"
                    click-change-color
                    speed-and-scale-temporary></a-box>
            </a-marker>
            <a-entity camera>
                <a-entity cursor="rayOrigin: mouse; fuse: false"
                          position="0 0 -1"
                          geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                          material="color: black; shader: flat"
                          scale="0.2 0.2 0.2">
            </a-entity>
        </a-scene>
    </body>
</html>
